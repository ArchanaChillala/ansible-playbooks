---
- hosts: vagrant

  vars:
    gem_bin_path: ~/.rvm/gems/$ruby/bin
    user: vagrant

  sudo: no

  tasks: 
    # Note that we run gem install commands via the Shell rather than directly in
    # Ansible because that seems to be necessary to play nicely with RVM

    - name: Ensure Jekyll's gem dependencies are installed
      shell: gem install {{ item.name }} -v {{ item.version }}
      with_items:
        - { name: 'liquid', version: '2.4.1' }
        - { name: 'kramdown', version: '0.13.8' }
        # Old version of Maruku as newer version fowls up JavaScript by wrapping it in CDATA tag
        - { name: 'maruku', version: '0.6.1' }
        - { name: 'sass', version: '3.2.5' }

    - name: Ensure python-pygments is installed
      apt: pkg=python-pygments state=installed
      sudo: yes

    - name: Ensure Jekyll is installed
      shell: gem install jekyll -v 0.12.1 --no-ri --no-rdoc

    - name: Ensure jekyll-pagination is installed
      shell: gem install jekyll-pagination -v 0.0.4

    # TODO: this is non-idempotent. Must be a cleaner way
    - name: Ensure terminal encodings are Jekyll friendly (i.e. utf-8)
      shell: echo "export {{ item }}=en_US.UTF-8" >> /home/vagrant/.bashrc
      with_items:
        - LC_ALL
        - LANG
